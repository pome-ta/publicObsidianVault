# codemirror とPythonista3

- wkwebview のキーボードのボタンhack
- codemirror のビルト調整

## codemirror 暫定build


`import * as hoge` と、マルっと持ってくる:


```js
import * as codemirror from 'codemirror';
import * as state from '@codemirror/state';
import * as view from '@codemirror/view';
import * as commands from '@codemirror/commands';
import * as autocomplete from '@codemirror/autocomplete';
import * as language from '@codemirror/language';
import * as javascript from '@codemirror/lang-javascript';
import * as oneDark  from '@codemirror/theme-one-dark';


export { codemirror, state, view, commands, autocomplete, language, javascript, oneDark };
```

[codeMirror6PlaySandBox/docs/js/editor/codemirror/bundleSrc/codemirror.src.js at main · pome-ta/codeMirror6PlaySandBox](https://github.com/pome-ta/codeMirror6PlaySandBox/blob/main/docs/js/editor/codemirror/bundleSrc/codemirror.src.js)


build したものを個別に`import` :


```js
import { codemirror, } from './codemirror.bundle.js';

export const { basicSetup, minimalSetup } = codemirror;
```

`export` の変数は、`./dist` とかにある本体のものをコピペ。
変数名が衝突する場合には、
`_` 等、プレフィックスを付けて宣言: 


```js
import { oneDark as _oneDark } from './codemirror.bundle.js';

export const { color, oneDark, oneDarkHighlightStyle, oneDarkTheme } = _oneDark;

```



[codeMirror6PlaySandBox/docs/js/editor/codemirror/codemirror.js at main · pome-ta/codeMirror6PlaySandBox · GitHub](https://github.com/pome-ta/codeMirror6PlaySandBox/blob/main/docs/js/editor/codemirror/codemirror.js)

### 完全なるアンチパターンか、、、

[import * as 構文とパフォーマンス最適化 #JavaScript - Qiita](https://qiita.com/uhyo/items/842e51e0d8cc46856d04)

## CodeMirror 上のキャレット

[テキスト入力時の点滅カーソルを変更する | RishunTrading](https://rishuntrading.co.jp/blog/css/input-text-caret-config/)

こんな感じだから、挙動が違う？


[Editor - Developer Documentation](https://docs.obsidian.md/Plugins/Editor/Editor)

Obsidian （モバイル）だと、キャレットいい感じなのになぁ


## `highlightWhitespace` のドットデカい問題

theme で調整するか？

こんな感じにした:

```js
const initTheme = EditorView.theme(
  {
    '&': {
      fontSize: '0.72rem',
      //fontSize: '1rem',
    },
    '.cm-scroller': {
      fontFamily:
        'Consolas, Menlo, Monaco, source-code-pro, Courier New, monospace',
    },
    '.cm-line': { padding: 0 },
    '&.cm-editor': {
      '&.cm-focused': {
        outline: '0px dotted #21212100',
      },
    },
    // `highlightWhitespace` 調整
    '.cm-highlightSpace': {
      backgroundImage: 'radial-gradient(circle at 50% 55%, #ababab 4%, transparent 24%)',
      opacity: 0.2,
    },
  },
);

```

（やはりpc で確認は強い）

画像で比較した方がいいかな？


### こうなると、インデントの線つけたりしたい

インデントレベル把握してもらって線つけたい、
けども、判断とかめんどうやな。偶数で出すとかかな？



## 独自機能のモジュール化

キーボードバーとか、やってき

### モバイル用アクセサリー

どのようなディレクトリ構成で、どこに置けばいいのかしら？

構成を考えていきたいけど、まずはできる状態でやるか


[iOSブラウザで快適に書けるエディターを作るの大変すぎ問題](https://zenn.dev/catnose99/articles/03035be9ceea73)

[iOS Safari でキーボード表示時にフッターを固定するもう1つの方法 - *iroi*](https://blog.chairoi.me/entry/safari-virtual-keyboard)


### ほかのテーマカラーとか？

vscode から変換とかでやってみたさあるかも


## `await` でコード持ってきたり？


`DOMContentLoaded` 挙動が面倒になるけど、最終的には、
`fetch` して取得するとなると、同等の処理の方が今後は楽か？


#codemirror #rollup #Pythonista3 #wkwebview 