# codemirror ã¨Pythonista3

- wkwebview ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒœã‚¿ãƒ³hack
- codemirror ã®ãƒ“ãƒ«ãƒˆèª¿æ•´

## codemirror æš«å®šbuild


`import * as hoge` ã¨ã€ãƒãƒ«ã£ã¨æŒã£ã¦ãã‚‹:


```js
import * as codemirror from 'codemirror';
import * as state from '@codemirror/state';
import * as view from '@codemirror/view';
import * as commands from '@codemirror/commands';
import * as autocomplete from '@codemirror/autocomplete';
import * as language from '@codemirror/language';
import * as javascript from '@codemirror/lang-javascript';
import * as oneDark  from '@codemirror/theme-one-dark';


export { codemirror, state, view, commands, autocomplete, language, javascript, oneDark };
```

[codeMirror6PlaySandBox/docs/js/editor/codemirror/bundleSrc/codemirror.src.js at main Â· pome-ta/codeMirror6PlaySandBox](https://github.com/pome-ta/codeMirror6PlaySandBox/blob/main/docs/js/editor/codemirror/bundleSrc/codemirror.src.js)


build ã—ãŸã‚‚ã®ã‚’å€‹åˆ¥ã«`import` :


```js
import { codemirror, } from './codemirror.bundle.js';

export const { basicSetup, minimalSetup } = codemirror;
```

`export` ã®å¤‰æ•°ã¯ã€`./dist` ã¨ã‹ã«ã‚ã‚‹æœ¬ä½“ã®ã‚‚ã®ã‚’ã‚³ãƒ”ãƒšã€‚
å¤‰æ•°åãŒè¡çªã™ã‚‹å ´åˆã«ã¯ã€
`_` ç­‰ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ã¦å®£è¨€: 


```js
import { oneDark as _oneDark } from './codemirror.bundle.js';

export const { color, oneDark, oneDarkHighlightStyle, oneDarkTheme } = _oneDark;

```



[codeMirror6PlaySandBox/docs/js/editor/codemirror/codemirror.js at main Â· pome-ta/codeMirror6PlaySandBox Â· GitHub](https://github.com/pome-ta/codeMirror6PlaySandBox/blob/main/docs/js/editor/codemirror/codemirror.js)

### å®Œå…¨ãªã‚‹ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã€ã€ã€

[import * as æ§‹æ–‡ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– #JavaScript - Qiita](https://qiita.com/uhyo/items/842e51e0d8cc46856d04)

## CodeMirror ä¸Šã®ã‚­ãƒ£ãƒ¬ãƒƒãƒˆ

[ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›æ™‚ã®ç‚¹æ»…ã‚«ãƒ¼ã‚½ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ | RishunTrading](https://rishuntrading.co.jp/blog/css/input-text-caret-config/)

ã“ã‚“ãªæ„Ÿã˜ã ã‹ã‚‰ã€æŒ™å‹•ãŒé•ã†ï¼Ÿ


[Editor - Developer Documentation](https://docs.obsidian.md/Plugins/Editor/Editor)

Obsidian ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰ã ã¨ã€ã‚­ãƒ£ãƒ¬ãƒƒãƒˆã„ã„æ„Ÿã˜ãªã®ã«ãªã


### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã€å¤‰æ›´ã•ã‚Œã¦ã‚‹èª¬

ã„ã¤ã‹ã‚‰ã®å¤‰åŒ–ã‹ã¯ã¾ã ã‚ã‹ã‚‰ã‚“ãŒã€
æœ€æ–°ã®ã‚’build ã™ã‚‹ã¨ã€handle ãŒå‡ºã¦ã“ãªã„ã€‚

[caretTest | shaderCodeMirror6WebGL/docs/js/modules at caretTest Â· pome-ta/shaderCodeMirror6WebGL Â· GitHub](https://github.com/pome-ta/shaderCodeMirror6WebGL/tree/caretTest/docs/js/modules)

[main | shaderCodeMirror6WebGL/docs/js/modules at main Â· pome-ta/shaderCodeMirror6WebGL Â· GitHub](https://github.com/pome-ta/shaderCodeMirror6WebGL/tree/main/docs/js/modules)


ãƒãƒ¼ã‚¸ãƒ§ãƒ³å·®åˆ†ç¢ºèªã¨ã€
build å·®åˆ†ã§åˆ¤æ˜ã§ãã‚‹ã¨ã„ã„ã‘ã©ã€‚

[å·®åˆ† | build Â· pome-ta/shaderCodeMirror6WebGL@ffc521e Â· GitHub](https://github.com/pome-ta/shaderCodeMirror6WebGL/commit/ffc521e15f19f0969c4c86f6b8cdb60ac1de044d)


## `highlightWhitespace` ã®ãƒ‰ãƒƒãƒˆãƒ‡ã‚«ã„å•é¡Œ

theme ã§èª¿æ•´ã™ã‚‹ã‹ï¼Ÿ

ã“ã‚“ãªæ„Ÿã˜ã«ã—ãŸ:

```js
const initTheme = EditorView.theme(
  {
    '&': {
      fontSize: '0.72rem',
      //fontSize: '1rem',
    },
    '.cm-scroller': {
      fontFamily:
        'Consolas, Menlo, Monaco, source-code-pro, Courier New, monospace',
    },
    '.cm-line': { padding: 0 },
    '&.cm-editor': {
      '&.cm-focused': {
        outline: '0px dotted #21212100',
      },
    },
    // `highlightWhitespace` èª¿æ•´
    '.cm-highlightSpace': {
      backgroundImage: 'radial-gradient(circle at 50% 55%, #ababab 4%, transparent 24%)',
      opacity: 0.2,
    },
  },
);

```

ï¼ˆã‚„ã¯ã‚Špc ã§ç¢ºèªã¯å¼·ã„ï¼‰

ç”»åƒã§æ¯”è¼ƒã—ãŸæ–¹ãŒã„ã„ã‹ãªï¼Ÿ


### ã“ã†ãªã‚‹ã¨ã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã®ç·šã¤ã‘ãŸã‚Šã—ãŸã„

ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«æŠŠæ¡ã—ã¦ã‚‚ã‚‰ã£ã¦ç·šã¤ã‘ãŸã„ã€
ã‘ã©ã‚‚ã€åˆ¤æ–­ã¨ã‹ã‚ã‚“ã©ã†ã‚„ãªã€‚å¶æ•°ã§å‡ºã™ã¨ã‹ã‹ãªï¼Ÿ



## ç‹¬è‡ªæ©Ÿèƒ½ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–

ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒãƒ¼ã¨ã‹ã€ã‚„ã£ã¦ã

### ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼

ã©ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§ã€ã©ã“ã«ç½®ã‘ã°ã„ã„ã®ã‹ã—ã‚‰ï¼Ÿ

æ§‹æˆã‚’è€ƒãˆã¦ã„ããŸã„ã‘ã©ã€ã¾ãšã¯ã§ãã‚‹çŠ¶æ…‹ã§ã‚„ã‚‹ã‹


[iOSãƒ–ãƒ©ã‚¦ã‚¶ã§å¿«é©ã«æ›¸ã‘ã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚’ä½œã‚‹ã®å¤§å¤‰ã™ãå•é¡Œ](https://zenn.dev/catnose99/articles/03035be9ceea73)

[iOS Safari ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¡¨ç¤ºæ™‚ã«ãƒ•ãƒƒã‚¿ãƒ¼ã‚’å›ºå®šã™ã‚‹ã‚‚ã†1ã¤ã®æ–¹æ³• - *iroi*](https://blog.chairoi.me/entry/safari-virtual-keyboard)



ã“ã®ç¨‹åº¦ã§ã‚‚ãˆãˆã‹ã‚‚ï¼Ÿ

[ãƒãƒ¼ãƒãƒ£ãƒ«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¼µã‚Šä»˜ã UI ã¨ Visual Viewport API - Katashin .info](https://katashin.info/posts/visual-viewport-api/)



## iPhone ã‚’mac ã«ç¹‹ã„ã§ã€ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ã§è¦‹ã¦ã¿ã‚‹

### æ‰‹é †

- iPhone ã‚’mac ã«ç¹‹ã
- iPhone ã§Obsidian ã‚’é–‹ã„ã¦ãŠã
- mac ä¸Šã®safari ã‹ã‚‰
  - `é–‹ç™º` ã‹ã‚‰ã€æ¥ç¶šèªè¨¼ã•ã‚Œã¦ã„ã‚‹iPhone é¸æŠ
    - mac ã«ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãŒå‡ºã‚‹
    - iPhone ã¯ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ä¸Šã§é¸æŠã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã‚‹
- ã‚´ãƒªã‚´ãƒªã¨è¦—ã„ã¦ã¿ã¦ã¿ã‚‹

### è¦—ã„ãŸãƒ¡ãƒ¢

- `<head>`
  - `<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">`
- `<body>`
  - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰çŠ¶æ…‹ã§ã€è¦ç´ ãŒå¤‰ã‚ã‚‹
    - `class="mobile-navbar"`
    - `class="mobile-toolbar"`

è¦ªã£ã½ã„`div` ã§: 
- `display: flex;`
- `height: 100%;`
- `width: 100%;`
- `position: relative;`
- `flex-direction: column;`


Web ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ä¸Šã®`ã‚½ãƒ¼ã‚¹` ã‹ã‚‰ã€ã€Œã‚¿ã‚¤ãƒ—åˆ¥ã€ã‚ˆã‚Šã€Œãƒ‘ã‚¹åˆ¥ã€ã®æ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã‹ã‚‚ï¼Ÿ


[Keyboard Capacitor Plugin API | Capacitor Documentation](https://capacitorjs.com/docs/apis/keyboard#keyboardinfo)

### `mobile-tool` ã§`app.css` ã‚’æ¤œç´¢

```css
--mobile-toolbar-height: 40px;
```

```css
.mobile-toolbar {
  -webkit-app-region: drag;
  flex: 0 0 auto;
  width: 100%;
  overflow-y: hidden;
  background-color: var(--background-primary);
  padding-bottom: var(--safe-area-inset-bottom);
  z-index: var(--layer-menu);
}
.mobile-toolbar-options-container {
  --scroll-fade-offset-right: var(--toolbar-option-width);
  position: relative;
  height: var(--mobile-toolbar-height);
  display: flex;
  width: 100%;
}
.mobile-toolbar-options-list {
  display: flex;
  width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  padding: 0 10px;
  scrollbar-width: none !important;
  /* Firefox */
  -ms-overflow-style: none !important;
  /* Internet Explorer 10+ */
}
.mobile-toolbar-options-list::-webkit-scrollbar {
  width: 0 !important;
  height: 0 !important;
}
.mobile-toolbar-floating-options {
  display: flex;
}
.mobile-toolbar-floating-options .mobile-toolbar-option {
  min-width: var(--toolbar-option-width);
  color: var(--text-accent);
}
.mobile-toolbar-option {
  display: flex;
  font-size: var(--font-ui-medium);
  color: var(--text-muted);
  font-family: var(--font-monospace);
  justify-content: center;
  align-items: center;
  min-width: var(--toolbar-option-width);
  position: relative;
  left: 0;
  transition: left 200ms ease-in-out;
}
```


### `localhost` ã¤ã¾ã‚Šã€`index.html` çš„ãªï¼Ÿ

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <meta http-equiv="Content-Security-Policy" content="style-src 'unsafe-inline' 'self' https://fonts.googleapis.com">
    <title>Obsidian</title>
    <link href="app.css" type="text/css" rel="stylesheet"/>
</head>
<body class="theme-dark">
    <script type="text/javascript" defer src="lib/codemirror/codemirror.js"></script>
    <script type="text/javascript" defer src="lib/codemirror/overlay.js"></script>
    <script type="text/javascript" defer src="lib/codemirror/markdown.js"></script>
    <script type="text/javascript" defer src="lib/codemirror/cm-addons.js"></script>
    <script type="text/javascript" defer src="lib/codemirror/vim.js"></script>
    <script type="text/javascript" defer src="lib/codemirror/meta.min.js"></script>
    <script type="text/javascript" defer src="lib/moment.min.js"></script>
    <script type="text/javascript" defer src="lib/pixi.min.js"></script>
    <script type="text/javascript" defer src="lib/i18next.min.js"></script>
    <script type="text/javascript" defer src="lib/scrypt.js"></script>
    <script type="text/javascript" defer src="lib/turndown.js"></script>
    <script type="text/javascript" defer src="enhance.js"></script>
    <script type="text/javascript" defer src="i18n.js"></script>
    <script type="text/javascript" defer src="app.js"></script>
</body>
</html>

```


`defer` èª­ã¿è¾¼ã¿ã—ã¦ã„ã‚‹ã®ã­ã€‚


ã ã‹ã‚‰ã€`enhance.js` ã¯:

```js
window.ready = function(t) {
    "loading" !== document.readyState ? t() : document.addEventListener("DOMContentLoaded", t)
},
```

ã¿ãŸã„ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹ã®ã‹ãªï¼Ÿ

### `app.js` å†…æ¢ç´¢

`mobile-tool` ã§æ¤œç´¢


`createDiv` ã£ã¦é–¢æ•°ã¯ã€ã©ã“ã§ç™ºç”Ÿã—ã¦ã„ã‚‹ã®ã‹




## `.js` ã§style æŒ‡å®š

[HTML DOM Style object](https://www.w3schools.com/jsref/dom_obj_style.asp)

[HTMLElement: style ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ - Web API | MDN](https://developer.mozilla.org/ja/docs/Web/API/HTMLElement/style#setting_styles)



### ã»ã‹ã®ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã¨ã‹ï¼Ÿ

vscode ã‹ã‚‰å¤‰æ›ã¨ã‹ã§ã‚„ã£ã¦ã¿ãŸã•ã‚ã‚‹ã‹ã‚‚


## `await` ã§ã‚³ãƒ¼ãƒ‰æŒã£ã¦ããŸã‚Šï¼Ÿ


`DOMContentLoaded` æŒ™å‹•ãŒé¢å€’ã«ãªã‚‹ã‘ã©ã€æœ€çµ‚çš„ã«ã¯ã€
`fetch` ã—ã¦å–å¾—ã™ã‚‹ã¨ãªã‚‹ã¨ã€åŒç­‰ã®å‡¦ç†ã®æ–¹ãŒä»Šå¾Œã¯æ¥½ã‹ï¼Ÿ


`.html` å†…ã§`defer` å‘¼ã°ãªãã¦ã‚‚è‰¯ã•ãã†ï¼Ÿ
`async` ã™ã‚‹ã¨ã€ãƒªãƒ­ãƒ¼ãƒ‰ã§èª­ã¿è¾¼ã‚ãªã„ã€‚

[[æ„è¦‹äº¤æ›] DOMContentLoaded ã¨ defer ã®ã©ã¡ã‚‰ã‚’ä½¿ã£ã¦ã„ã¾ã™ã‹ï¼Ÿï¼Ÿ - Qiita](https://qiita.com/benjuwan/questions/66dd52fc5fa7bafb2c5a)


## Pythonista3 ã§ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒœã‚¿ãƒ³

js é–¢ä¿‚ã¯ã€pc é€£å‹•ç¢ºèªã—ã¦ã€
æºå¸¯ã§ã€objc ã§è‰²ã€…èª¿æŸ»ã™ã‚‹ã‹


[Objective-Cã®é»’é­”è¡“ãŒã‚ˆãã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã§è¦—ã„ã¦ã¿ãŸğŸ‘» #Swift - Qiita](https://qiita.com/mopiemon/items/8d0dd7d678c4dadeadd4)


[WKWebViewã®å®Œäº†ãƒœã‚¿ãƒ³ã‚’æ¶ˆã—ãŸè©± #Swift - Qiita](https://qiita.com/rokubay/items/e25936a35b4ad47d1447)



å¯¾å¿œå®Œäº†ã€‚

ä¸Šè¨˜ãƒªãƒ³ã‚¯ã®æ›¸ãæ›ãˆæ–¹å¼ã§ã¯ãªãã€
ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒå‘¼ã°ã‚Œã‚‹åº¦ã«ã€å·®ã—è¾¼ã‚€ä»•çµ„ã¿ã€‚


class ãŒå¤§ãããªã£ã¦ã—ã¾ã£ãŸã®ã§ã€
ã“ã®æ©Ÿèƒ½ã¯åˆ¥ã«åˆ†ã‘ã‚‹æ–¹é‡ã‚‚ã‚ã‚Šã‹ã‚‚ã€‚


#codemirror #rollup #Pythonista3 #wkwebview 