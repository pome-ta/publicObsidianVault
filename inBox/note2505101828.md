# p5.js Web Editor

[GitHub - processing/p5.js-web-editor: The p5.js Editor is a website for creating p5.js sketches, with a focus on making coding accessible and inclusive for artists, designers, educators, beginners, and anyone else! You can create, share, or remix p5.js sketches without needing to download or configure anything.](https://github.com/processing/p5.js-web-editor)

~~エディタ部分をcodemirror とかに置き換えたい~~

勘違い: `"codemirror": "^5.62.0"` だから、5系ではなく6系に替えてみる。という表現が適切か？


# リポジトリ調査

## ブラウザエディタで見えてるもの

ブラウザエディタ上で登場する、スクリプトが記述されている場所はどこか？

```js
function setup() {
  createCanvas(400, 400);
}

function draw() {
  background(220);
}
```

[p5.js-web-editor/server/domain-objects/createDefaultFiles.js](https://github.com/processing/p5.js-web-editor/blob/develop/server/domain-objects/createDefaultFiles.js "createDefaultFiles.js")


`.html` としている内容もここに書かれてた


`createDefaultFiles` として、返している

## `domain-objects/`

- `__test__` ディレクトリ
  - `Project.js` を`import` してtest してる
    - `containsRootHtmlFile` , `toModel` , `transformFiles` , `FileValidationError` を使ってUI 作ってる感じ？
    - 他のコードからtest の実装を探せば、追っかけできるかも
  - ちゃんと読めば失敗させる動きがわかるかも？
- `Project.js`
  - `Object.entries` とかのjs の`Object` しぐさ理解してないか勉強か、、、
  - `export function toModel(object)`
    - This converts between the public API's Project object properties and a mongoose Project model
    - これはパブリックAPI のProject オブジェクトのプロパティとmongoose のProject モデルを変換します。
      - なるほど？🤔
  - `import Project from '../models/project';`
- `createDefaultFiles.js`


### `lodash` って何だっけ？

#### とりまググり

検索結果の適当なピックアップ

- [Lodash](https://lodash.com/)
- [【JavaScript】lodashの使い方 #JavaScript - Qiita](https://qiita.com/sosomuse/items/a08e28def541c28458a0)
- [Lodashで使える便利な関数と代替可能なJavaScriptの標準機能](https://zenn.dev/cti1650/articles/lodash_functions)

#### 使われている関数

##### `isPlainObject`

[isPlainObject | Lodash Documentation](https://lodash.com/docs/4.17.15#isPlainObject)

##### `pick`

[pick | Lodash Documentation](https://lodash.com/docs/4.17.15#pick)

### `Object(.entries)`


### `mongoose`

[Mongoose ODM v8.14.2](https://mongoosejs.com/)

MongoDB 😇

## `server/models/project.js`


```js
const projectSchema = new Schema(
  {
    name: {
      type: String,
      default: "Hello p5.js, it's the server",
      maxlength: 128
    },
    user: { type: Schema.Types.ObjectId, ref: 'User' },
    serveSecure: { type: Boolean, default: false },
    files: { type: [fileSchema] },
    _id: { type: String, default: shortid.generate },
    slug: { type: String }
  },
  { timestamps: true }
);
```
`mongoose` に、`models.Project` てのがあって、それか、`Schema` として、設定したものをブチ込む？


## build 

そもそも、build をしたら、どのように吐き出されるのかを確認したい。

`server` ディレクトリにある。どのような処理だから、`server` となるのか？

が、カジュアルにbuild できないんよなぁ


[p5.js-web-editor/contributor_docs/README.md at develop · processing/p5.js-web-editor · GitHub](https://github.com/processing/p5.js-web-editor/blob/develop/contributor_docs/README.md)

ここ読めば、いろいろと判明するかな？


## CodeMirror はどこに？

これか？

`client/utils/codemirror-search.js`

[p5.js-web-editor/client/utils/codemirror-search.js at develop · processing/p5.js-web-editor](https://github.com/processing/p5.js-web-editor/blob/develop/client/utils/codemirror-search.js)


こっちか
`client/modules/IDE/components/Editor/index.jsx`
[p5.js-web-editor/client/modules/IDE/components/Editor/index.jsx at develop · processing/p5.js-web-editor · GitHub](https://github.com/processing/p5.js-web-editor/blob/develop/client/modules/IDE/components/Editor/index.jsx)

[@emmetio/codemirror-plugin - npm](https://www.npmjs.com/package/@emmetio/codemirror-plugin)

react でコネコネするのね


## `components/Editor/index.jsx` の挙動


書き換わる状態を見つけたい。

`constructor(props)` で、`this.props` が何かしてる。

[this._cm.on](https://github.com/processing/p5.js-web-editor/blob/c175c1c8d21915b7a0838795cd25bf5f3ab05a96/client/modules/IDE/components/Editor/index.jsx#L191)





#p5js #editor #js #codemirror #draft #github 
