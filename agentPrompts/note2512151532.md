TDD ã®æ‰‹æ³•ã«å‰‡ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‚’èµ°ã‚‰ã›ã¦ã„ã‚‹ã€‚
ã“ã“ã‹ã‚‰ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä»¥å¤–ã®ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ï¼ˆ`vfs-core.js` ã®VFS ã®ç¸®å°ãªã©ï¼‰ã‚’æ‰‹ã‚’ã¤ã‘ã‚‹ã¨ã„ã†ç†è§£ã€‚

## ãƒ†ã‚¹ãƒˆçµæœ

â€» å¤šåˆ†éåŒæœŸå®Ÿè¡Œã®ãŸã‚ã€å®Ÿè¡Œçµæœã®é †ç•ªãŒé•ã†ã®ã ã¨æ€ã†ãŒã€å¿µã®ãŸã‚2å›å®Ÿè¡Œã—ã¦ã„ã‚‹


### 1å›ç›®

```
1.Â âœ… VFS API throws before ensureReady: Passed
2. âœ… worker/ready does not imply VFS ready: Passed
3. âŒ LSP initialize fails before ensureReady: expected false to equal true
4. âŒ VFS ensureReady initializes env: null is not an object (evaluating 'result.ok')
5. âŒ VFS resetForTest resets all state: Unknown method: vfs/getEnvInfo
6. âŒ VFS ensureReady is idempotent: Unknown method: vfs/getEnvInfo
7. âœ… LSP initialize succeeds after VFS ready: Passed

```


```
ğŸš€ main.js loaded
ğŸ§© vfs-ensureReady.test loaded
ğŸ§© vfs-ensureReady-idempotent.test loaded
ğŸ§© vfs-before-ensureReady.test loaded
ğŸ§© vfs-resetForTest.test loaded
ğŸ§© worker-ready-semantics.test loaded
ğŸ§© lsp-initialize-before-vfs.test loaded
ğŸ§© lsp-initialize-success.test loaded
ğŸš€ test-runner.js loaded
[23:13:37.922 | WorkerLog] [Worker] Worker loaded and ready.
[23:13:37.920 | WorkerLog] [Worker] Worker loaded and ready.
[23:13:37.912 | WorkerLog] [Worker] Worker loaded and ready.
[23:13:37.921 | WorkerLog] [Worker] Worker loaded and ready.
[23:13:37.915 | WorkerLog] [Worker] Worker loaded and ready.
[23:13:37.919 | WorkerLog] [Worker] Worker loaded and ready.
[23:13:37.909 | WorkerLog] [Worker] Worker loaded and ready.
[23:13:37.933 | WorkerLog] [Worker] Debug mode set true
[23:13:37.934 | WorkerLog] [Worker] Debug mode set true
[23:13:37.935 | WorkerLog] [Worker] Received: vfs/openFile (id:1)
[23:13:37.935 | WorkerLog] [Worker] Received: vfs/ensureReady (id:3)
[23:13:37.935 | WorkerLog] [Worker] Received: vfs/ensureReady (id:4)
[23:13:37.935 | WorkerLog] [Worker] Error: vfs/openFile failed: VFS env not created
[23:13:37.935 | WorkerLog] [Worker] Received: vfs/ensureReady (id:2)
[23:13:37.935 | WorkerLog] [Worker] Received: lsp/initialize (id:9)
[23:13:37.936 | WorkerLog] [Worker] Received: vfs/ensureReady (id:8)
[23:13:37.936 | WorkerLog] [Worker] Received: vfs/openFile (id:7)
[23:13:37.936 | WorkerLog] [Worker] LSP initialize params: {}
[23:13:37.936 | WorkerLog] [Worker] VFS init attempt 1/3
[23:13:37.936 | WorkerLog] [Worker] LspServer instance created
[23:13:37.936 | WorkerLog] [Worker] LSP initialize (opts): {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:37.936 | WorkerLog] [Worker] Error: vfs/openFile failed: VFS env not created
[23:13:37.937 | WorkerLog] [Worker] VFS init attempt 1/3
[23:13:37.943 | WorkerLog] [Worker] Received: vfs/ensureReady (id:5)
[23:13:37.944 | WorkerLog] [Worker] Received: vfs/ensureReady (id:6)
[23:13:40.051 | WorkerLog] [Worker] defaultMap size: 79
[23:13:40.053 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:40.058 | WorkerLog] [Worker] defaultMap size: 79
[23:13:40.059 | WorkerLog] [Worker] defaultMap size: 79
[23:13:40.060 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:40.059 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:40.107 | WorkerLog] [Worker] defaultMap size: 79
[23:13:40.111 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:40.112 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:13:40.112 | WorkerLog] [Worker] VFS ensureReady complete
[23:13:40.112 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:40.113 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=2)
[23:13:40.113 | WorkerLog] [Worker] LspServer initialized, env created.
[23:13:40.113 | WorkerLog] [Worker] Finished: lsp/initialize
[23:13:40.116 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:13:40.115 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:13:40.116 | WorkerLog] [Worker] VFS ensureReady complete
[23:13:40.116 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:13:40.117 | WorkerLog] [Worker] Received: vfs/getEnvInfo (id:10)
[23:13:40.117 | WorkerLog] [Worker] Error: Unknown method: vfs/getEnvInfo
[23:13:40.122 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:13:40.122 | WorkerLog] [Worker] VFS ensureReady complete
[23:13:40.123 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:13:40.124 | WorkerLog] [Worker] Received: vfs/getEnvInfo (id:11)
[23:13:40.124 | WorkerLog] [Worker] Error: Unknown method: vfs/getEnvInfo
[23:13:40.153 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:13:40.153 | WorkerLog] [Worker] VFS ensureReady complete
[23:13:40.153 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:13:40.153 | WorkerLog] [Worker] Received: lsp/initialize (id:12)
[23:13:40.153 | WorkerLog] [Worker] LSP initialize params: {}
[23:13:40.154 | WorkerLog] [Worker] LspServer instance created
[23:13:40.154 | WorkerLog] [Worker] LSP initialize (opts): {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:40.154 | WorkerLog] [Worker] Using existing cachedDefaultMap (already ready)
[23:13:40.154 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:13:40.155 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=2)
[23:13:40.155 | WorkerLog] [Worker] LspServer initialized, env created.
[23:13:40.155 | WorkerLog] [Worker] Finished: lsp/initialize

```


### 2å›ç›®



```
1. âœ… VFS API throws before ensureReady: Passed
2. âœ… worker/ready does not imply VFS ready: Passed
3. âŒ VFS ensureReady initializes env: null is not an object (evaluating 'result.ok')
4. âœ… LSP initialize succeeds after VFS ready: Passed
5. âŒ VFS resetForTest resets all state: Unknown method: vfs/getEnvInfo
6. âŒ VFS ensureReady is idempotent: Unknown method: vfs/getEnvInfo
7. âŒ LSP initialize fails before ensureReady: expected false to equal true

```

```
ğŸš€ main.js loaded
ğŸ§© vfs-ensureReady.test loaded
ğŸ§© vfs-ensureReady-idempotent.test loaded
ğŸ§© vfs-before-ensureReady.test loaded
ğŸ§© vfs-resetForTest.test loaded
ğŸ§© worker-ready-semantics.test loaded
ğŸ§© lsp-initialize-before-vfs.test loaded
ğŸ§© lsp-initialize-success.test loaded
ğŸš€ test-runner.js loaded
[23:15:25.024 | WorkerLog] [Worker] Worker loaded and ready.
[23:15:25.020 | WorkerLog] [Worker] Worker loaded and ready.
[23:15:25.015 | WorkerLog] [Worker] Worker loaded and ready.
[23:15:25.025 | WorkerLog] [Worker] Worker loaded and ready.
[23:15:25.019 | WorkerLog] [Worker] Worker loaded and ready.
[23:15:25.035 | WorkerLog] [Worker] Debug mode set true
[23:15:25.036 | WorkerLog] [Worker] Debug mode set true
[23:15:25.037 | WorkerLog] [Worker] Received: vfs/ensureReady (id:1)
[23:15:25.037 | WorkerLog] [Worker] Received: vfs/ensureReady (id:4)
[23:15:25.038 | WorkerLog] [Worker] Received: vfs/openFile (id:3)
[23:15:25.038 | WorkerLog] [Worker] Received: lsp/initialize (id:2)
[23:15:25.038 | WorkerLog] [Worker] Received: vfs/openFile (id:9)
[23:15:25.038 | WorkerLog] [Worker] Received: vfs/ensureReady (id:7)
[23:15:25.038 | WorkerLog] [Worker] Received: vfs/ensureReady (id:8)
[23:15:25.038 | WorkerLog] [Worker] LSP initialize params: {}
[23:15:25.038 | WorkerLog] [Worker] VFS init attempt 1/3
[23:15:25.039 | WorkerLog] [Worker] VFS init attempt 1/3
[23:15:25.039 | WorkerLog] [Worker] LspServer instance created
[23:15:25.039 | WorkerLog] [Worker] Error: vfs/openFile failed: VFS env not created
[23:15:25.039 | WorkerLog] [Worker] VFS init attempt 1/3
[23:15:25.039 | WorkerLog] [Worker] LSP initialize (opts): {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:25.040 | WorkerLog] [Worker] VFS init attempt 1/3
[23:15:25.049 | WorkerLog] [Worker] Received: vfs/ensureReady (id:5)
[23:15:25.050 | WorkerLog] [Worker] Received: vfs/ensureReady (id:6)
[23:15:26.957 | WorkerLog] [Worker] defaultMap size: 79
[23:15:26.959 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:26.960 | WorkerLog] [Worker] defaultMap size: 79
[23:15:26.962 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:27.003 | WorkerLog] [Worker] defaultMap size: 79
[23:15:27.004 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:27.010 | WorkerLog] [Worker] defaultMap size: 79
[23:15:27.011 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:27.013 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:15:27.014 | WorkerLog] [Worker] VFS ensureReady complete
[23:15:27.014 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:15:27.014 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:15:27.014 | WorkerLog] [Worker] VFS ensureReady complete
[23:15:27.015 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:15:27.016 | WorkerLog] [Worker] Received: lsp/initialize (id:10)
[23:15:27.016 | WorkerLog] [Worker] LSP initialize params: {}
[23:15:27.017 | WorkerLog] [Worker] LspServer instance created
[23:15:27.017 | WorkerLog] [Worker] LSP initialize (opts): {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:27.018 | WorkerLog] [Worker] Using existing cachedDefaultMap (already ready)
[23:15:27.018 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:27.019 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=2)
[23:15:27.019 | WorkerLog] [Worker] LspServer initialized, env created.
[23:15:27.019 | WorkerLog] [Worker] Finished: lsp/initialize
[23:15:27.053 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:15:27.053 | WorkerLog] [Worker] VFS ensureReady complete
[23:15:27.053 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:15:27.054 | WorkerLog] [Worker] Received: vfs/getEnvInfo (id:11)
[23:15:27.054 | WorkerLog] [Worker] Error: Unknown method: vfs/getEnvInfo
[23:15:27.054 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:15:27.055 | WorkerLog] [Worker] VFS ensureReady complete
[23:15:27.055 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:15:27.056 | WorkerLog] [Worker] Finished: vfs/ensureReady
[23:15:27.056 | WorkerLog] [Worker] Received: vfs/getEnvInfo (id:12)
[23:15:27.056 | WorkerLog] [Worker] Error: Unknown method: vfs/getEnvInfo
[23:15:27.058 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=1)
[23:15:27.058 | WorkerLog] [Worker] VFS ensureReady complete
[23:15:27.059 | WorkerLog] [Worker] createEnvironment: about to create env; roots: [], initialFiles: [], opts: {"target":9,"module":99,"moduleResolution":100,"strict":true,"allowImportingTsExtensions":true,"allowArbitraryExtensions":true,"resolvePackageJsonExports":true,"resolvePackageJsonImports":true,"skipLibCheck":true,"useDefineForClassFields":true,"noEmit":true}
[23:15:27.059 | WorkerLog] [Worker] VFS environment created; roots: [] (envId=2)
[23:15:27.060 | WorkerLog] [Worker] LspServer initialized, env created.
[23:15:27.060 | WorkerLog] [Worker] Finished: lsp/initialize

```

## ç¾çŠ¶æ§‹æˆã¨ã‚³ãƒ¼ãƒ‰

ä»¥ä¸‹ãŒå®Ÿè¡Œã—ãŸæ§‹æˆã¨ã‚³ãƒ¼ãƒ‰ã€‚